$(function(){var f=(function(k){if(k==""){return{}}var j={};for(var l=0;l<k.length;++l){var m=k[l].split("=");if(m.length!=2){continue}j[m[0]]=decodeURIComponent(m[1].replace(/\+/g," "))}return j})(window.location.search.substr(1).split("&"));window.gridbrowser=function(m,j,l){var k;loc=window.location;k=loc.protocol+"//"+loc.host+"/@@gridbrowser";if(k.indexOf("?")<0){k=k+"?type="+l}else{k=k+"&type="+l}window.document.getElementById("grid-fieldname").value=m;window.open(k,"Grid Browser","width=800,height=600,status=yes,scrollbars=yes,resizable=yes")};window.gridbrowserdialog={init:function(){var n=window.opener.document.getElementById("grid-fieldname").value;n=window.opener.document.getElementById(n);var m=n.getAttribute("data-url");var k=n.getAttribute("data-use");var j=n.getAttribute("data-custom-text");var l=n.getAttribute("data-extra-style");if(m!==null){$("input[name=url]").val(m)}if(k!==null){$("select[name=use]").val(k)}if(l!==null){$("input[name=extra_style]").val(l)}if(j!==null){tinyMCE.activeEditor.setContent(j)}},submit:function(){var m=$("input[name=url]").val();var k=$("select[name=use]").val();var j=tinyMCE.activeEditor.getContent();var l=$("input[name=extra_style]").val();var n=window.opener.document.getElementById("grid-fieldname").value;n=window.opener.document.getElementById(n);n.setAttribute("data-url",m);n.setAttribute("data-use",k);n.setAttribute("data-custom-text",j);n.setAttribute("data-extra-style",l);window.opener.reload_tile(n);return window.close()}};window.reload_tile=function(q){var p=$(q);var n={};var k=p.attr("data-url");var j=p.attr("data-use");var o=p.attr("data-custom-text");var m=p.attr("data-extra-style");var r=p.attr("data-sizex");n.url=k;n.use=j;n.custom_text=o;n.extra_style=m;var l="/@@tile-content";if(r!==undefined){n.size_x=r}p.children(".tile-content").load(l,n).fadeIn("slow")};function g(){var j=gridster.serialize();j=JSON.stringify(j,null,2);$.post("save-grid",{tiles:j},function(k){if(!k===true){alert("Error while saving tiles: "+k)}else{window.location.href=window.location.href}})}$("#save-tiles").click(function(){g()});$("#add-tile").popover({html:true,content:function(j){return b("/@@add-tile","tile-adder")}});function b(k,j){$.ajax({url:k,success:function(l){$("#"+j).html(l)}});return'<div id="'+j+'">Loading...</div>'}window.rm_tile=function(j){window.gridster.remove_widget(j);$("#tile-removed-alert").fadeIn().delay(1000).fadeOut("slow")};if($(".cpick").length>0){var h=undefined;$(".cpick").ColorPicker({onShow:function(j){h=$(this).parent().parent();$(j).fadeIn(500);return false},onChange:function(j,l,k){h.css("backgroundColor","#"+l)}})}var a=false;var c=150;var i=150;var e=10;var d=10;$.ajax({async:false,url:"/@@grid_settings",success:function(j){a=j.resize_tiles;c=j.width;i=j.height;e=j.margin_x;d=j.margin_y}});if(a){$(window).on("load",function(){window.gridster.resize_widget_dimensions=function(k){if(k.widget_margins){this.options.widget_margins=k.widget_margins}if(k.widget_base_dimensions){this.options.widget_base_dimensions=k.widget_base_dimensions}this.min_widget_width=(this.options.widget_margins[0]*2)+this.options.widget_base_dimensions[0];this.min_widget_height=(this.options.widget_margins[1]*2)+this.options.widget_base_dimensions[1];var j=this.serialize();this.$widgets.each($.proxy(function(l,n){var o=$(n);var m=j[l];this.resize_widget(o,m.size_x,m.size_y)},this));this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();return false};$(window).resize(function(){var j=$(window).width();var m=window.gridster.cols;var l=$(".container").width()/m-e/(m-2);var k=i;window.gridster.resize_widget_dimensions({widget_base_dimensions:[l,k]})});$(window).resize()})}});