$(function(){var f=(function(k){if(k==""){return{}}var j={};for(var l=0;l<k.length;++l){var m=k[l].split("=");if(m.length!=2){continue}j[m[0]]=decodeURIComponent(m[1].replace(/\+/g," "))}return j})(window.location.search.substr(1).split("&"));window.gridbrowser=function(m,j,l){var k;loc=window.location;k=loc.protocol+"//"+loc.host+"/@@gridbrowser";if(k.indexOf("?")<0){k=k+"?type="+l}else{k=k+"&type="+l}window.document.getElementById("grid-fieldname").value=m;window.open(k,"Grid Browser","width=800,height=600,status=yes,scrollbars=yes,resizable=yes")};window.gridbrowserdialog={init:function(){var m=window.opener.document.getElementById("grid-fieldname").value;m=window.opener.document.getElementById(m);var l=m.getAttribute("data-url");var j=m.getAttribute("data-use");var k=m.getAttribute("data-extra-style");if(l!==null){$("input[name=url]").val(l)}if(j!==null){$("select[name=use]").val(j)}if(k!==null){$("input[name=extra_style]").val(k)}},submit:function(){var l=$("input[name=url]").val();var j=$("select[name=use]").val();var k=$("input[name=extra_style]").val();var m=window.opener.document.getElementById("grid-fieldname").value;m=window.opener.document.getElementById(m);m.setAttribute("data-url",l);m.setAttribute("data-use",j);m.setAttribute("data-extra-style",k);window.opener.reload_tile(m);return window.close()}};window.reload_tile=function(q){var o=$(q);var p={};var m=o.attr("data-url");var j=o.attr("data-use");var k=o.attr("data-extra-style");var l=o.attr("data-sizex");p.url=m;p.use=j;p.extra_style=k;var n="/@@tile-content";if(l!==undefined){p.size_x=l}o.children(".tile-content").load(n,p).fadeIn("slow")};function g(){var j=gridster.serialize();j=JSON.stringify(j,null,2);$.post("save-grid",{tiles:j,},function(k){if(!k===true){alert("Error while saving tiles: "+k)}else{window.location.href=window.location.href}})}$("#save-tiles").click(function(){g()});$("#add-tile").popover({html:true,content:function(j){return b("/@@add-tile","tile-adder")}});function b(k,j){$.ajax({url:k,success:function(l){$("#"+j).html(l)}});return'<div id="'+j+'">Loading...</div>'}window.rm_tile=function(j){window.gridster.remove_widget(j);$("#tile-removed-alert").fadeIn().delay(1000).fadeOut("slow")};if($(".cpick").length>0){var h=undefined;$(".cpick").ColorPicker({onShow:function(j){h=$(this).parent().parent();$(j).fadeIn(500);return false},onChange:function(j,l,k){h.css("backgroundColor","#"+l)},})}var a=false;var c=150;var i=150;var e=10;var d=10;$.ajax({async:false,url:"/@@grid_settings",success:function(j){a=j.resize_tiles;c=j.width;i=j.height;e=j.margin_x;d=j.margin_y}});if(a){window.onload=function(){window.gridster.resize_widget_dimensions=function(k){if(k.widget_margins){this.options.widget_margins=k.widget_margins}if(k.widget_base_dimensions){this.options.widget_base_dimensions=k.widget_base_dimensions}this.min_widget_width=(this.options.widget_margins[0]*2)+this.options.widget_base_dimensions[0];this.min_widget_height=(this.options.widget_margins[1]*2)+this.options.widget_base_dimensions[1];var j=this.serialize();this.$widgets.each($.proxy(function(l,n){var o=$(n);var m=j[l];this.resize_widget(o,m.sizex,m.sizey)},this));this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();return false};$(window).resize(function(){console.log("resize");var j=$(window).width();var m=window.gridster.cols;var l=$(".container").width()/m-e/2;var k=i;window.gridster.resize_widget_dimensions({widget_base_dimensions:[l,k]})});$(window).resize()}}});